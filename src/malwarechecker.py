import json
import boto3
import os





def handler(event, context):
    dynamodb_client = boto3.resource('dynamodb')

    url_to_validate=event['pathParameters']['url']
    
    table = dynamodb_client.Table(os.environ['TABLE_NAME'])

    try:
        result=table.get_item(
        Key={
            'malwareURLs' : url_to_validate
        }
        )
    except Exception, e:
        return {'statusCode': 500,
                'body': json.dumps({
                    'error_message': 'Server Error'
                    })}

    try:
        item = result['Item']
    except Exception as ex:  
      return {'statusCode': 200,
                'body': json.dumps({
                    'URL requested': url_to_validate,
                    'isURLSafe':'YES'
                  })}
    
    return {'statusCode': 200,
                'body': json.dumps({
                    'URL requested': url_to_validate,
                    'isURLSafe':'NO'
                  })}
    