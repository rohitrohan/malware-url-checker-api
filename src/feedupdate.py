import json
import boto3
import os


def handler(event, context):
    s3_client=boto3.resource('s3')
    dynamodb_client = boto3.client('dynamodb')
    s3_bucket_name = os.environ['BUCKET_NAME']
    dynamedb_table_name = os.environ['TABLE_NAME']
    s3_feed_file_name = os.environ['FEED_FILE_NAME']
    content = s3_client.Object(s3_bucket_name, s3_feed_file_name).get()['Body'].read()

    urls=content.split(",")

    for atomicUrl in urls:
      print atomicUrl
      item = {'malwareURLs': {'S': atomicUrl}}
      dynamodb_client.put_item(TableName=dynamedb_table_name, Item=item)
      

    body = {
        "message": "Go  Serverless v1.0!Your function executed successfully!",
        "input": content
    }

    response = {
        "statusCode": 200,
        "body": json.dumps(body)
    }

    return response
    